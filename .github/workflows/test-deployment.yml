name: Validate Pull Request 

on:
  pull_request:
    branches: ["release-candidate/**", main]
    types: [opened, synchronize, reopened, ready_for_review]
    paths:
      - "force-app/**"

  workflow_dispatch:

jobs:
  apex-test:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - name: Information
        run: echo "Repository $GITHUB_REPOSITORY, SHA $GITHUB_SHA and Owner $GITHUB_REPOSITORY_OWNER."
      - name: Checkout source code
        uses: actions/checkout@v1
      - name: Authorize Salesforce org
        uses: sfdx-actions/setup-sfdx@v1
        with:
            sfdx-auth-url: ${{ secrets.SALESFORCE_DEPLOYMENT_ORG_SECRECT }}
      - name: Deploy source code
        run: sfdx force:source:deploy -p force-app
      - name: Run apex tests
        run: sfdx force:apex:test:run -c -r human --wait 45
